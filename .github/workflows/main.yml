name: Build IT Agent Universal

on:
  workflow_dispatch:

jobs:
  build-universal-compatible:
    # QUAN TRỌNG NHẤT: Dùng macos-13 (đây là runner chạy chip Intel x86_64)
    # Nó sẽ tạo ra file app chạy được trên cả Intel và Apple Silicon (qua Rosetta)
    runs-on: macos-13

    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11' # Python 3.11 tương thích tốt nhất hiện tại

      - name: Install Dependencies
        run: |
          pip install --upgrade pip
          # Cài thẳng thư viện cần thiết (khỏi lo thiếu file requirements.txt)
          pip install psutil requests pyinstaller

      - name: Build App (Intel/Universal Mode)
        run: |
          # Build ra file .app
          pyinstaller --noconfirm --onefile --windowed --name "IT_Device_Info_Agent" agent.py

      - name: Zip App
        run: |
          cd dist
          # Nén lại để giữ nguyên cấu trúc file Mac
          zip -r IT_Device_Info_Agent.zip IT_Device_Info_Agent.app

      - name: Upload Result
        uses: actions/upload-artifact@v4
        with:
          name: Mac-App-Universal
          path: dist/IT_Device_Info_Agent.zip
